# sbt-swift-plugin

Sbt plugin to send files to swift

This plugin uses [openstack-swift-client](https://gitlab.com/makeorg/platform/openstack-swift-client)
in order to have non-blocking calls.

## Why this plugin

This plugin sends reports generated by some sbt task in a swift storage.

Use cases for this plugin include:
- coverage reports
- load testing reports
- javadoc

## Configuration and usage

### In your project

in your `project/plugins.sbt` file, add:

```scala
addSbtPlugin("org.make" % "sbt-swift-plugin" % "1.0.3")
```

then configure it in your `build.sbt` for it.

Here is an example to send scoverage-generated reports.

```sbtshell
enablePlugins(SbtSwift)

swiftContainerName := "reports"
swiftConfigurationPath := file("/var/run/secrets/swift.conf")
swiftContainerDirectory := {
  val currentBranch: String = {
    if(Option(System.getenv("CI_COMMIT_REF_NAME")).exists(_.nonEmpty)) {
      System.getenv("CI_COMMIT_REF_NAME")
    } else {
      git.gitCurrentBranch.value
    }
  }
  Some(s"main-api/${LocalDate.now().toString}/$currentBranch/${version.value}")
}
swiftReportsToSendPath := {
  (Compile / crossTarget).value / "scoverage-report"
}
``` 

where:

- `swiftContainerName` is the name of the swift container to use (equivalent to the S3 bucket)
- `swiftConfigurationPath` if the path to the swift configuration (see below for content)
- `swiftContainerDirectory` is a path to append to all the files sent in swift. 
   This directory will typically contain data to distinguish builds, like the version, git commit, current date, ...
- `swiftReportsToSendPath` if the directory with the generated reports. It can also be a single file if needed

### Swift configuration

Here is an example file to configure swift:

```
make-openstack {
  authentication {
    keystone-version = "keystone-V2"
    base-url = "http://localhost:8080/auth/v2.0"
    tenant-name = "test"
    username = "tester"
    password = "testing"
    region = "REG1"
  }

  storage {
    init-containers = ["test1", "test2"]
  }
}  
```

For more information on the configuration and what it means, see 
[openstack-swift-client](https://gitlab.com/makeorg/platform/openstack-swift-client)
